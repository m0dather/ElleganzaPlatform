@model ElleganzaPlatform.Application.ViewModels.Store.OrderDetailsViewModel
@{
    Layout = "_AccountLayout";
    ViewBag.Title = "Order Details";
    
    string GetStatusBadgeClass(string status)
    {
        return status.ToLower() switch
        {
            "pending" => "badge bg-warning text-dark",
            "paid" => "badge bg-success text-white",  // Phase 4: Payment integration
            "processing" => "badge bg-info text-white",
            "shipped" => "badge bg-primary text-white",
            "delivered" => "badge bg-success text-white",
            "cancelled" => "badge bg-danger text-white",
            "failed" => "badge bg-danger text-white",  // Phase 4: Payment integration
            _ => "badge bg-secondary text-white"
        };
    }
}

<div class="my-account-content account-order">
    <div class="mb-4">
        <a href="@Url.Action("Orders", "Account")" class="tf-btn btn-outline animate-hover-btn rounded-0">
            <span><i class="icon-arrow-left"></i> Back to Orders</span>
        </a>
    </div>

                            <!-- Order Header -->
                            <div class="wd-form-order mb-4">
                                <div class="order-head">
                                    <div class="content">
                                        <div class="@GetStatusBadgeClass(Model.Status)">@Model.Status</div>
                                        <h6 class="mt-3 fw-5">Order @Model.OrderNumber</h6>
                                        <p class="text-muted mt-2">Placed on @Model.CreatedAt.ToString("MMMM dd, yyyy")</p>
                                        @if (!string.IsNullOrEmpty(Model.PaymentTransactionId))
                                        {
                                            <!-- Phase 4: Show payment transaction ID if available -->
                                            <p class="text-muted mt-1">
                                                <small>Transaction ID: @Model.PaymentTransactionId</small>
                                            </p>
                                        }
                                        @if (Model.CanBePaid)
                                        {
                                            <!-- Phase 4: Pay Now button for pending orders -->
                                            <form asp-controller="Payment" asp-action="CreatePayment" method="post" class="mt-3">
                                                @Html.AntiForgeryToken()
                                                <input type="hidden" name="orderId" value="@Model.Id" />
                                                <button type="submit" class="tf-btn btn-fill animate-hover-btn rounded-0" style="background-color: #28a745; border-color: #28a745;">
                                                    <span>Pay Now</span>
                                                </button>
                                            </form>
                                        }
                                    </div>
                                </div>
                            </div>

                            <!-- Order Items -->
                            <div class="wrap-account-order mb-4">
                                <h6 class="fw-6 mb-3">Order Items</h6>
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th class="fw-6">Product</th>
                                                <th class="fw-6">SKU</th>
                                                <th class="fw-6">Quantity</th>
                                                <th class="fw-6">Unit Price</th>
                                                <th class="fw-6">Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in Model.Items)
                                            {
                                                <tr>
                                                    <td>
                                                        <span class="fw-5">@item.ProductName</span>
                                                    </td>
                                                    <td>@item.ProductSku</td>
                                                    <td>@item.Quantity</td>
                                                    <td>$@item.UnitPrice.ToString("F2")</td>
                                                    <td class="fw-6">$@item.TotalPrice.ToString("F2")</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Order Summary -->
                            <div class="row">
                                <div class="col-lg-6 mb-4">
                                    <h6 class="fw-6 mb-3">Shipping Address</h6>
                                    <div class="p-3 border rounded">
                                        <p class="mb-0">@Model.ShippingAddress</p>
                                    </div>
                                </div>
                                <div class="col-lg-6 mb-4">
                                    <h6 class="fw-6 mb-3">Billing Address</h6>
                                    <div class="p-3 border rounded">
                                        <p class="mb-0">@Model.BillingAddress</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Order Totals -->
                            <div class="row">
                                <div class="col-lg-6 ms-auto">
                                    <div class="p-3 border rounded">
                                        <h6 class="fw-6 mb-3">Order Summary</h6>
                                        <ul class="list-unstyled">
                                            <li class="d-flex justify-content-between text-2 mb-2">
                                                <span>Subtotal:</span>
                                                <span class="fw-6">$@Model.SubTotal.ToString("F2")</span>
                                            </li>
                                            <li class="d-flex justify-content-between text-2 mb-2">
                                                <span>Tax:</span>
                                                <span class="fw-6">$@Model.TaxAmount.ToString("F2")</span>
                                            </li>
                                            <li class="d-flex justify-content-between text-2 mb-3 pb-3 border-bottom">
                                                <span>Shipping:</span>
                                                <span class="fw-6">$@Model.ShippingAmount.ToString("F2")</span>
                                            </li>
                                            <li class="d-flex justify-content-between text-2">
                                                <span class="fw-6 fs-5">Total:</span>
                                                <span class="fw-6 fs-5 text-primary">$@Model.TotalAmount.ToString("F2")</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

